{"version":3,"sources":["dda/c4k_gitea/browser.cljs"],"mappings":"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","names":["dda.c4k-gitea.browser/generate-group","name","content","dda.c4k-gitea.browser/generate-content","dda.c4k_common.common.concat_vec","cljs.core.assoc","dda.c4k-common.browser/generate-needs-validation","dda.c4k-common.browser/generate-input-field","dda.c4k-common.browser/generate-text-area","dda.c4k-common.browser/generate-br","dda.c4k-common.browser/generate-button","dda.c4k-common.browser/generate-output","dda.c4k-gitea.browser/generate-content-div","dda.c4k-gitea.browser/config-from-document","issuer","dda.c4k_common.browser.get_content_from_element","app-name","domain-whitelist","cljs.core.merge","dda.c4k-common.browser/get-content-from-element","js/parseInt","clojure.string/blank?","dda.c4k-gitea.browser/validate-all!","dda.c4k-common.browser/validate!","dda.c4k_common.browser.validate_BANG_","dda.c4k-gitea.gitea/auth?","cljs.tools.reader.edn/read-string","dda.c4k-common.browser/set-form-validated!","dda.c4k-gitea.browser/add-validate-listener","dda.c4k-common.browser/get-element-by-id","dda.c4k-gitea.browser/init","dda.c4k-common.browser/append-hickory","js/document","dda.c4k-common.common/generate-common","dda.c4k-gitea.gitea/config-defaults","dda.c4k-gitea.core/k8s-objects","dda.c4k-common.browser/set-output!"],"sourcesContent":["(ns dda.c4k-gitea.browser\n  (:require\n   [clojure.string :as st]\n   [clojure.tools.reader.edn :as edn]\n   [dda.c4k-gitea.core :as core]\n   [dda.c4k-gitea.gitea :as gitea]\n   [dda.c4k-common.browser :as br]   \n   [dda.c4k-common.common :as cm]))\n\n(defn generate-group\n  [name\n   content]\n  [{:type :element\n    :tag :div\n    :attrs {:class \"rounded border border-3  m-3 p-2\"}\n    :content [{:type :element\n               :tag :b\n               :attrs {:style \"z-index: 1; position: relative; top: -1.3rem;\"}\n               :content name}\n              {:type :element\n               :tag :fieldset\n               :content content}]}])\n\n(defn generate-content []\n  (cm/concat-vec\n   [(assoc\n     (br/generate-needs-validation) :content\n     (cm/concat-vec\n      (generate-group\n       \"domain\"\n       (cm/concat-vec\n        (br/generate-input-field \"fqdn\" \"Your fqdn:\" \"repo.test.de\")\n        (br/generate-input-field \"mailer-from\" \"Your mailer email address:\" \"test@test.de\")\n        (br/generate-input-field \"mailer-host-port\" \"Your mailer host with port:\" \"test.de:123\")\n        (br/generate-input-field \"service-noreply-address\" \"Your noreply domain:\" \"test.de\")\n        (br/generate-input-field \"issuer\" \"(Optional) Your issuer prod/staging:\" \"\")\n        (br/generate-input-field \"app-name\" \"(Optional) Your app name:\" \"\")\n        (br/generate-input-field \"domain-whitelist\" \"(Optional) Domain whitelist for registration email-addresses:\" \"\")))\n      (generate-group\n       \"provider\"\n       (cm/concat-vec\n        (br/generate-input-field \"volume-total-storage-size\" \"Your gitea volume-total-storage-size:\" \"20\")))\n      (generate-group\n       \"credentials\"\n       (br/generate-text-area\n        \"auth\" \"Your auth.edn:\"\n        \"{:postgres-db-user \\\"gitea\\\"\n         :postgres-db-password \\\"gitea-db-password\\\"\n         :mailer-user \\\"test@test.de\\\"\n         :mailer-pw \\\"mail-test-password\\\"}\"\n        \"5\"))\n      [(br/generate-br)]\n      (br/generate-button \"generate-button\" \"Generate c4k yaml\")))]\n   (br/generate-output \"c4k-gitea-output\" \"Your c4k deployment.yaml:\" \"25\")))\n\n(defn generate-content-div\n  []\n  {:type :element\n   :tag :div\n   :content\n   (generate-content)})\n\n(defn config-from-document []\n  (let [issuer (br/get-content-from-element \"issuer\" :optional true)\n        app-name (br/get-content-from-element \"app-name\" :optional true)\n        domain-whitelist (br/get-content-from-element \"domain-whitelist\" :optional true)]\n    (merge\n     {:fqdn (br/get-content-from-element \"fqdn\")\n      :mailer-from (br/get-content-from-element \"mailer-from\")\n      :mailer-host-port (br/get-content-from-element \"mailer-host-port\")\n      :service-noreply-address (br/get-content-from-element \"service-noreply-address\")\n      :volume-total-storage-size (br/get-content-from-element \"volume-total-storage-size\" :deserializer js/parseInt)}     \n     (when (not (st/blank? issuer))\n       {:issuer issuer})\n     (when (not (st/blank? app-name))\n       {:default-app-name app-name})\n     (when (not (st/blank? domain-whitelist))\n       {:service-domain-whitelist domain-whitelist})\n     )))\n\n(defn validate-all! []\n  (br/validate! \"fqdn\" ::gitea/fqdn)\n  (br/validate! \"mailer-from\" ::gitea/mailer-from)\n  (br/validate! \"mailer-host-port\" ::gitea/mailer-host-port)\n  (br/validate! \"service-noreply-address\" ::gitea/service-noreply-address)\n  (br/validate! \"issuer\" ::gitea/issuer :optional true)\n  (br/validate! \"app-name\" ::gitea/default-app-name :optional true)\n  (br/validate! \"domain-whitelist\" ::gitea/service-domain-whitelist :optional true)  \n  (br/validate! \"volume-total-storage-size\" ::gitea/volume-total-storage-size :deserializer js/parseInt)\n  (br/validate! \"auth\" gitea/auth? :deserializer edn/read-string)\n  (br/set-form-validated!))\n\n(defn add-validate-listener [name]\n  (-> (br/get-element-by-id name)\n      (.addEventListener \"blur\" #(do (validate-all!)))))\n\n\n(defn init []\n  (br/append-hickory (generate-content-div))\n  (-> js/document\n      (.getElementById \"generate-button\")\n      (.addEventListener \"click\"\n                         #(do (validate-all!)\n                              (-> (cm/generate-common\n                                   (config-from-document)\n                                   (br/get-content-from-element \"auth\" :deserializer edn/read-string)\n                                   gitea/config-defaults\n                                   core/k8s-objects)\n                               (br/set-output!)))))\n  (add-validate-listener \"fqdn\")\n  (add-validate-listener \"mailer-from\")\n  (add-validate-listener \"mailer-host-port\")\n  (add-validate-listener \"service-noreply-address\")\n  (add-validate-listener \"app-name\")\n  (add-validate-listener \"domain-whitelist\")  \n  (add-validate-listener \"volume-total-storage-size\")\n  (add-validate-listener \"issuer\")\n  (add-validate-listener \"auth\"))"]}